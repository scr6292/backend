<html>
{% extends "layout_progress_bar.html" %}
{% import "bootstrap/wtf.html" as wtf %}
{% block head %}
{{ super() }}
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
{% endblock head %}
{% block content %}

	<div class="container">
	    {% if numeric %}
	    <div class="alert alert-danger" role="alert" style="margin-top: 10px; margin-bottom: 60px;">
	      Por favor introduce un valor numérico.
	    </div>
	    {% endif %}
	    {% if doubleorder %}
	    <div class="alert alert-danger" role="alert" style="margin-top: 10px; margin-bottom: 60px;">
	      Ya has realizado pedido esta semana.
	    </div>
	    {% endif %}
		<div align="center">
			<h1 class="title" style="margin-top: 20px">Cesta de la compra</h1>
			<hr width="80%" class="separator">
		</div>
    <div class="row justify-content-center" align="center">
      <div class="col-lg-12">
        <h4 style="position: relative; float: left; margin-bottom: 10px;">Revisa o actualiza tu pedido y confirma tu compra</h4>
        <table class="table">
          <tbody> {% from "_formhelpers.html" import render_field %}
            <form action = "{{url_for('postOrder',agricultor_id=agricultor_id)}}" method = 'POST' >

              {% for i in order %}
              <tr class="postorder {{loop.index}}">
    						<!-- <td>{{i.product_price}}€/{{i.product_units}}
                </td> -->
                <td align="center" class="align-middle" style="width: 30px">
                  <a class="eliminar" href="{{url_for('deleteItem', agricultor_id = agricultor_id, pedido_id = i.id)}}">
                    <i class="material-icons align-middle">cancel</i>
                  </a>
                </td>
                <td>
                  <input id = "{{loop.index}}" class="form-control" type = 'text' size = '7' name = '{{i.product_name}}' placeholder = '{{i.quantity}} {{i.product_units}}'>
                </td>
    						<td>
    				      {{i.product_name}}
                </td>
                <td style="display:none">
                	{{i.product_price}}
                </td>
                <td>
                  {{(i.quantity|float)*(i.product_price|float)}}€
                </td>

              </tr>
              {% endfor %}

              <tr>
                <td></td>
                <td></td>
                <td><b>Total</b></td>
                <td class="precio-total-productos" style="color: #000; font-weight: bold">{{ total }}€</td>
              </tr>

                <button class='btn btn-lg btn-success update-order' type = 'submit' value = 'Actualiza tu compra' style='display:none'>
                </button>
            </form>

        </table>
      </div>
      <div class="row justify-content-center" align="center">

      </div>
    </div>
    <div>
      <a class"compra" href="{{url_for('agricultorMenuOrder', agricultor_id = agricultor_id)}}">
        <button type="button" class="btn btn-outline-success">
          <i class="material-icons align-middle">local_grocery_store</i>
            Seguir comprando
        </button>
      </a>
    </div>
    {% if total < 25 %}
    <div class="alert alert-danger" role="alert" style="margin-top: 10px; margin-bottom: 60px;">
      Los pedidos inferiores a 25€ no se entregan a domicilio.
    </div>
    {% endif %}

<footer class="fixed-bottom">
  	<div class="row justify-content-center">
  		<div>
  			<p class="text-right vertical-align-middle subtotal"> Subtotal: {{ total }}€ </p>
  		</div>
  		<div>
  			<button type="button" class="btn footer-button float-right" onclick="document.getElementsByClassName('update-order')[0].click()">Finalizar compra</button>
  		</div>
  	</div>
</footer>

<script>
	boxes = document.getElementsByClassName("form-control")
	for (j=0 ; j < boxes.length ; j++){
		boxes[j].onchange = function(){
			n_products = {{n_order}}
			total1 = 0
			for (j=0 ; j < boxes.length ; j++){
				if (boxes[j].value != ""){
				var n_products = n_products + 1
				var total1 = total1 + (parseFloat(document.getElementsByClassName(j+1)[0].getElementsByTagName('td')[3].innerHTML) * parseFloat(boxes[j].value))

				document.getElementsByClassName(j+1)[0].getElementsByTagName('td')[4].innerHTML = (parseFloat(document.getElementsByClassName(j+1)[0].getElementsByTagName('td')[3].innerHTML) * parseFloat(boxes[j].value)).toFixed(2) + "€"
				}
				else{
					total1 = total1 + parseFloat(document.getElementsByClassName("form-control")[j].placeholder.split(" ")[0])*parseFloat(document.getElementsByClassName(j+1)[0].getElementsByTagName('td')[3].innerHTML)
					document.getElementsByClassName(j+1)[0].getElementsByTagName('td')[4].innerHTML = (parseFloat(document.getElementsByClassName(j+1)[0].getElementsByTagName('td')[3].innerHTML) * parseFloat(document.getElementsByClassName("form-control")[j].placeholder.split(" ")[0])).toFixed(2) + "€"
				}
			total2 = total1

			document.getElementsByClassName("subtotal")[0].innerHTML = "SUBTOTAL: " + total1.toFixed(2) + "€"
			document.getElementsByClassName("precio-total-productos")[0].innerHTML = total1.toFixed(2) + "€"
			}
		}
	}

</script>


{% endblock content %}
